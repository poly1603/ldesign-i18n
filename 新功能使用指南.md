# @ldesign/i18n æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—ä»‹ç» v3.0 ä¼˜åŒ–åæ–°å¢çš„å¼€å‘å·¥å…·å’ŒåŠŸèƒ½ã€‚

## ğŸ” ç¿»è¯‘é”®éªŒè¯å™¨

### åŸºæœ¬ä½¿ç”¨

```typescript
import { globalKeyValidator, validateTranslationKey } from '@ldesign/i18n'

// æ–¹æ³•1: ä½¿ç”¨å…¨å±€éªŒè¯å™¨
globalKeyValidator.setAvailableKeys(['app.title', 'app.description', 'user.name'])

const result = globalKeyValidator.validateKey('app.titel') // æ‹¼å†™é”™è¯¯
console.log(result)
// {
//   isValid: false,
//   suggestions: ['app.title'],
//   didYouMean: 'app.title',
//   score: 0.9
// }

// æ–¹æ³•2: å¿«é€ŸéªŒè¯
const quickResult = validateTranslationKey('user.name', ['user.name', 'user.email'])
// { isValid: true, suggestions: [], score: 1 }
```

### æ‰¹é‡éªŒè¯

```typescript
const keys = ['app.title', 'app.desciption', 'user.nmae'] // æœ‰æ‹¼å†™é”™è¯¯

const results = globalKeyValidator.validateKeys(keys)
const invalidKeys = globalKeyValidator.getInvalidKeys(keys)

console.log('æ— æ•ˆçš„é”®:', invalidKeys)
// ['app.desciption', 'user.nmae']

const stats = globalKeyValidator.getValidationStats(keys)
console.log('éªŒè¯ç»Ÿè®¡:', stats)
// { total: 3, valid: 1, invalid: 2, validRate: 0.33 }
```

### åœ¨ç¿»è¯‘å‰è‡ªåŠ¨éªŒè¯

```typescript
const i18n = new OptimizedI18n({ /* ... */ })

// è®¾ç½®éªŒè¯å™¨
globalKeyValidator.setAvailableKeys(
  i18n.getMessages('zh-CN') ? Object.keys(flattenObject(i18n.getMessages('zh-CN'))) : []
)

// ç¿»è¯‘å‰éªŒè¯
function safeTranslate(key: string) {
  const validation = globalKeyValidator.validateKey(key)

  if (!validation.isValid && validation.didYouMean) {
    console.warn(`é”® "${key}" ä¸å­˜åœ¨,ä½ æ˜¯å¦æƒ³è¦ "${validation.didYouMean}"?`)
  }

  return i18n.t(key)
}
```

## ğŸ“Š æ€§èƒ½åˆ†æå™¨

### åŸºæœ¬æ€§èƒ½åˆ†æ

```typescript
import { globalProfiler } from '@ldesign/i18n/debug'

// å¼€å§‹åˆ†æ
globalProfiler.startProfiling()

// æ‰§è¡Œç¿»è¯‘æ“ä½œ
i18n.t('app.title')
i18n.t('user.profile.name', { name: 'John' })
i18n.plural('item', 5)

// åœæ­¢å¹¶è·å–æŠ¥å‘Š
const report = globalProfiler.stopProfiling()

console.log('æ€»æ“ä½œæ•°:', report.totalOperations)
console.log('å¹³å‡è€—æ—¶:', report.averageDuration.toFixed(2), 'ms')
console.log('ç¼“å­˜å‘½ä¸­ç‡:', (report.cacheHitRate! * 100).toFixed(1), '%')
console.log('ä¼˜åŒ–å»ºè®®:', report.recommendations)
```

### é«˜çº§æ€§èƒ½åˆ†æ

```typescript
// æ‰‹åŠ¨æ ‡è®°æ“ä½œ
const operationId = globalProfiler.markStart('custom-operation', 'translation', {
  component: 'UserProfile'
})

// ... æ‰§è¡Œè€—æ—¶æ“ä½œ ...

globalProfiler.markEnd(operationId)

// è·å–æ…¢æ“ä½œ
const slowOps = globalProfiler.getSlowOperations(10) // è¶…è¿‡ 10ms çš„æ“ä½œ
console.log('æ…¢æ“ä½œ:', slowOps)

// å¯¼å‡ºæ•°æ®
const data = globalProfiler.exportData()
console.log('æ€§èƒ½æ•°æ®:', data)
```

### ä½¿ç”¨è£…é¥°å™¨

```typescript
import { performanceTracker } from '@ldesign/i18n/debug'

class TranslationService {
  @performanceTracker('translation')
  translate(key: string): string {
    return i18n.t(key)
  }

  @performanceTracker('load')
  async loadLanguage(locale: string) {
    // ... åŠ è½½é€»è¾‘ ...
  }
}
```

## ğŸ” ç¿»è¯‘æ£€æŸ¥å™¨

### è¿½è¸ªç¿»è¯‘ä½¿ç”¨

```typescript
import { globalInspector } from '@ldesign/i18n/debug'

// è®¾ç½®å¯ç”¨çš„é”®
globalInspector.setAvailableKeys(['app.title', 'app.description', 'user.name'])

// å¼€å§‹è¿½è¸ª
globalInspector.startTracking()

// ç¿»è¯‘æ—¶è‡ªåŠ¨è®°å½•
// (éœ€è¦åœ¨ i18n.t() ä¸­é›†æˆ,æˆ–æ‰‹åŠ¨è®°å½•)
globalInspector.recordTranslation('app.title', 'zh-CN', true)
globalInspector.recordTranslation('app.missing', 'zh-CN', false)

// ç”ŸæˆæŠ¥å‘Š
const report = globalInspector.generateReport()

console.log('æ€»è°ƒç”¨:', report.totalCalls)
console.log('å”¯ä¸€é”®:', report.uniqueKeys)
console.log('ç¼ºå¤±çš„é”®:', report.missingKeys)
console.log('æœ€å¸¸ç”¨çš„é”®:', report.mostUsed)
console.log('æœªä½¿ç”¨çš„é”®:', report.unusedKeys)
console.log('è¦†ç›–ç‡:', report.coverage.percentage.toFixed(1), '%')
```

### å¯¼å‡ºä½¿ç”¨æŠ¥å‘Š

```typescript
// å¯¼å‡ºä¸º JSON
const jsonReport = globalInspector.exportReport('json')
console.log(jsonReport)

// å¯¼å‡ºä¸º CSV
const csvReport = globalInspector.exportReport('csv')
// å¯ä»¥ä¿å­˜ä¸ºæ–‡ä»¶æˆ–å¤åˆ¶åˆ° Excel

// å®æ—¶ç»Ÿè®¡
const stats = globalInspector.getRealTimeStats()
console.log('å®æ—¶ç»Ÿè®¡:', stats)
// { trackedKeys: 15, totalCalls: 142, missingCount: 3, locales: 2 }
```

### å¯è§†åŒ–è°ƒè¯• (æµè§ˆå™¨)

```typescript
// é«˜äº®æ˜¾ç¤ºç¼ºå¤±çš„ç¿»è¯‘
globalInspector.highlightMissingKeys()

// æ˜¾ç¤ºç¿»è¯‘è¾¹ç•Œ
globalInspector.showTranslationBoundaries()
```

## ğŸ¨ é›†æˆåˆ°é¡¹ç›®

### Vue 3 é¡¹ç›®é›†æˆ

```vue
<template>
  <div>
    <h1>{{ t('app.title') }}</h1>
    <button @click="showDebugInfo">æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯</button>
  </div>
</template>

<script setup lang="ts">
import { useI18n } from '@ldesign/i18n/vue';
import { globalInspector, globalProfiler } from '@ldesign/i18n/debug';

const { t } = useI18n();

// å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•
if (import.meta.env.DEV) {
  globalInspector.startTracking();
  globalProfiler.startProfiling();
}

function showDebugInfo() {
  const report = globalInspector.generateReport();
  const perfReport = globalProfiler.stopProfiling();

  console.group('ğŸ› è°ƒè¯•ä¿¡æ¯');
  console.log('ç¼ºå¤±çš„é”®:', report.missingKeys);
  console.log('æ€§èƒ½å»ºè®®:', perfReport.recommendations);
  console.groupEnd();
}
</script>
```

### React é¡¹ç›®é›†æˆ

```tsx
import { globalInspector } from '@ldesign/i18n/debug'
import { useEffect } from 'react'

function App() {
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      globalInspector.startTracking()

      return () => {
        const report = globalInspector.generateReport()
        console.log('ç¿»è¯‘ä½¿ç”¨æŠ¥å‘Š:', report)
        globalInspector.stopTracking()
      }
    }
  }, [])

  return <div>{/* ... */}</div>
}
```

## ğŸ”§ é…ç½®å»ºè®®

### å¼€å‘ç¯å¢ƒé…ç½®

```typescript
import { createI18n, globalKeyValidator } from '@ldesign/i18n'
import { globalInspector, globalProfiler } from '@ldesign/i18n/debug'

const i18n = createI18n({
  locale: 'zh-CN',
  messages: { /* ... */ },

  // å¯ç”¨è¯¦ç»†è°ƒè¯•
  debug: true,
  warnOnMissing: true,

  // è‡ªå®šä¹‰ç¼ºå¤±é”®å¤„ç†
  missingKeyHandler: (key, locale, namespace, defaultValue) => {
    // è®°å½•åˆ°æ£€æŸ¥å™¨
    globalInspector.recordTranslation(key, locale, false)

    // éªŒè¯å¹¶æä¾›å»ºè®®
    const validation = globalKeyValidator.validateKey(key)
    if (validation.didYouMean) {
      console.warn(`é”® "${key}" ä¸å­˜åœ¨,ä½ æ˜¯å¦æƒ³è¦ "${validation.didYouMean}"?`)
    }

    return defaultValue || `[${key}]`
  },
})

// å¯åŠ¨å·¥å…·
if (import.meta.env.DEV) {
  globalProfiler.startProfiling()
  globalInspector.startTracking()

  // 5åˆ†é’Ÿåç”ŸæˆæŠ¥å‘Š
  setTimeout(() => {
    console.log('æ€§èƒ½æŠ¥å‘Š:', globalProfiler.stopProfiling())
    console.log('ä½¿ç”¨æŠ¥å‘Š:', globalInspector.generateReport())
  }, 5 * 60 * 1000)
}
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```typescript
import { createI18n } from '@ldesign/i18n'

const i18n = createI18n({
  locale: 'zh-CN',
  messages: { /* ... */ },

  // ç”Ÿäº§ç¯å¢ƒé™é»˜æ¨¡å¼
  debug: false,
  warnOnMissing: false,

  // ç®€å•çš„ç¼ºå¤±é”®å¤„ç†
  missingKeyHandler: (key, locale, namespace, defaultValue) => {
    // å¯ä»¥ä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
    return defaultValue || key
  },
})
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘é˜¶æ®µä½¿ç”¨éªŒè¯å™¨

åœ¨å¼€å‘æ–°åŠŸèƒ½å‰,å…ˆéªŒè¯ç¿»è¯‘é”®:

```typescript
const keysToTranslate = ['feature.title', 'feature.description']
const stats = globalKeyValidator.getValidationStats(keysToTranslate)

if (stats.invalid > 0) {
  console.warn(`å‘ç° ${stats.invalid} ä¸ªæ— æ•ˆçš„ç¿»è¯‘é”®,è¯·å…ˆæ·»åŠ ç¿»è¯‘!`)
}
```

### 2. å®šæœŸç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

```typescript
// åœ¨åº”ç”¨å¯åŠ¨æ—¶
if (import.meta.env.DEV) {
  setInterval(() => {
    const report = globalProfiler.stopProfiling()
    console.log('ğŸ“Š æ€§èƒ½æŠ¥å‘Š:', report.recommendations)
    globalProfiler.startProfiling() // é‡æ–°å¼€å§‹
  }, 10 * 60 * 1000) // æ¯10åˆ†é’Ÿ
}
```

### 3. å‘å¸ƒå‰æ£€æŸ¥è¦†ç›–ç‡

```typescript
const report = globalInspector.generateReport()

if (report.coverage.percentage < 80) {
  console.warn(`âš ï¸ ç¿»è¯‘è¦†ç›–ç‡è¾ƒä½: ${report.coverage.percentage.toFixed(1)}%`)
  console.log('æœªä½¿ç”¨çš„é”®:', report.unusedKeys.slice(0, 10))
}
```

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: æ€§èƒ½åˆ†æå™¨ä¼šå½±å“æ€§èƒ½å—?

A: ä¼šæœ‰è½»å¾®å½±å“(~1-2%),å»ºè®®ä»…åœ¨å¼€å‘ç¯å¢ƒæˆ–æ€§èƒ½è°ƒä¼˜æ—¶å¯ç”¨ã€‚

### Q: ç¿»è¯‘æ£€æŸ¥å™¨éœ€è¦æ‰‹åŠ¨è®°å½•å—?

A: ç›®å‰æ˜¯çš„ã€‚æœªæ¥ç‰ˆæœ¬ä¼šè€ƒè™‘è‡ªåŠ¨é›†æˆåˆ° i18n.t() ä¸­ã€‚

### Q: è¿™äº›å·¥å…·ä¼šå¢åŠ æ‰“åŒ…ä½“ç§¯å—?

A: ä¸ä¼šã€‚ä½¿ç”¨æ‡’åŠ è½½å¯¼å‡º,ä»…åœ¨å¼€å‘ç¯å¢ƒæˆ–ä¸»åŠ¨å¯¼å…¥æ—¶æ‰åŠ è½½ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¼˜åŒ–å®Œæˆæ€»ç»“](./ä¼˜åŒ–å®Œæˆæ€»ç»“_2025.md)
- [ä¼˜åŒ–è¿›åº¦æŠ¥å‘Š](./OPTIMIZATION_PROGRESS.md)
- [API å‚è€ƒ](./API_REFERENCE_NEW.md)

---

**æœ€åæ›´æ–°**: 2025-10-25
